generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum EventVisibility {
  Public
  Members
  Private
}

enum EventStatus {
  Draft
  Published
  Archived
}

enum RSVPStatus {
  Interested
  Going
  Declined
  Waitlist
}

model comments {
  id         Int       @id @default(autoincrement())
  post_id    Int
  user_id    Int
  content    String
  created_at DateTime? @default(now()) @db.Timestamp(6)
  updated_at DateTime? @default(now()) @updatedAt @db.Timestamp(6)
  posts      posts     @relation(fields: [post_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([post_id], map: "idx_comments_post_id")
  @@index([user_id], map: "idx_comments_user_id")
}

model event_registration {
  id            Int        @id @default(autoincrement())
  event_id      Int
  user_id       Int
  registered_at DateTime   @default(now()) @db.Timestamp(6)
  rsvp          RSVPStatus @default(Interested)
  check_in      Boolean    @default(false)
  notes         String?
  events        events     @relation(fields: [event_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users         users      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, event_id])
  @@index([event_id], map: "idx_eventreg_event")
  @@index([user_id], map: "idx_eventreg_user")
}

model events {
  id                 Int                  @id @default(autoincrement())
  title              String               @db.VarChar(255)
  description        String
  location           String               @db.VarChar(255)
  start_time         DateTime             @db.Timestamp(6)
  end_time           DateTime             @db.Timestamp(6)
  created_by         Int
  created_at         DateTime?            @default(now()) @db.Timestamp(6)
  updated_at         DateTime?            @default(now()) @db.Timestamp(6)
  slug               String?              @unique
  timezone           String               @default("UTC")
  visibility         EventVisibility      @default(Public)
  status             EventStatus          @default(Draft)
  capacity           Int                  @default(10)
  venue_id           Int?
  deleted            Boolean              @default(false)
  event_registration event_registration[]
  venues             venues?              @relation(fields: [venue_id], references: [id])
  users              users                @relation(fields: [created_by], references: [id], onDelete: Cascade, onUpdate: NoAction)
  outbox_emails      outbox_emails[]      @relation("EventOutboxEmails")

  @@index([created_by], map: "idx_events_created_by")
  @@index([start_time], map: "idx_events_start_time")
}

model post_likes {
  id         Int       @id @default(autoincrement())
  post_id    Int
  user_id    Int
  created_at DateTime? @default(now()) @db.Timestamp(6)
  posts      posts     @relation(fields: [post_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([post_id], map: "idx_postlikes_post")
  @@index([user_id], map: "idx_postlikes_user")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model posts {
  id          Int          @id @default(autoincrement())
  user_id     Int
  title       String       @db.VarChar(255)
  category    String       @db.VarChar(100)
  read_time   String?      @db.VarChar(50)
  short_desc  String       @db.VarChar(500)
  content     String
  created_at  DateTime?    @default(now()) @db.Timestamp(6)
  updated_at  DateTime?    @default(now()) @db.Timestamp(6)
  image_url   String?
  is_approved Boolean      @default(false)
  is_deleted  Boolean      @default(false)

  comments   comments[]
  post_likes post_likes[]
  users      users        @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at(sort: Desc)], map: "idx_posts_created_at")
  @@index([user_id], map: "idx_posts_user_id")
}


model private_messages {
  id                                        Int       @id @default(autoincrement())
  subject                                   String    @db.VarChar(255)
  content                                   String
  sent_date                                 DateTime? @default(now()) @db.Timestamp(6)
  read_at                                   DateTime? @db.Timestamp(6)
  sender_id                                 Int
  receiver_id                               Int
  users_private_messages_receiver_idTousers users     @relation("private_messages_receiver_idTousers", fields: [receiver_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users_private_messages_sender_idTousers   users     @relation("private_messages_sender_idTousers", fields: [sender_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([receiver_id], map: "idx_messages_receiver")
  @@index([sender_id], map: "idx_messages_sender")
  @@index([sent_date(sort: Desc)], map: "idx_messages_sent_date")
}

model users {
  id                                                   Int                  @id @default(autoincrement())
  first_name                                           String               @db.VarChar(100)
  last_name                                            String               @db.VarChar(100)
  email                                                String               @unique @db.VarChar(255)
  password_hash                                        String
  role                                                 String?              @default("user") @db.VarChar(20)
  username                                             String               @unique @db.VarChar(30)
  profile_picture                                      String?
  enrollment_year                                      Int
  is_active                                            Boolean              @default(true)
  occupation                                           String?              @db.VarChar(255)
  created_at                                           DateTime?            @default(now()) @db.Timestamp(6)
  updated_at                                           DateTime?            @default(now()) @db.Timestamp(6)
  work_location                                        String?              @db.VarChar(255)
  is_public                                            Boolean              @default(true)
  cv_url                                               String?              @db.VarChar(255)
  position                                             String?              @db.VarChar(255)
  study_direction                                      String?              @db.VarChar(255)
  study_level                                          String?              @db.VarChar(255)
  comments                                             comments[]
  event_registration                                   event_registration[]
  events                                               events[]
  post_likes                                           post_likes[]
  posts                                                posts[]
  private_messages_private_messages_receiver_idTousers private_messages[]   @relation("private_messages_receiver_idTousers")
  private_messages_private_messages_sender_idTousers   private_messages[]   @relation("private_messages_sender_idTousers")
  outbox_emails                                        outbox_emails[]      @relation("UserOutboxEmails")

  @@index([enrollment_year], map: "idx_users_graduation_year")
}

model venues {
  id         Int      @id @default(autoincrement())
  name       String   @unique
  address    String?
  capacity   Int?
  events     events[]
  created_at DateTime @default(now())
}

model outbox_emails {
  id         Int      @id @default(autoincrement())
  to         String
  subject    String
  body       String
  sent       Boolean  @default(false)
  created_at DateTime @default(now())

  user_id  Int?
  event_id Int?

  user  users?  @relation(fields: [user_id], references: [id], name: "UserOutboxEmails")
  event events? @relation(fields: [event_id], references: [id], name: "EventOutboxEmails")
}